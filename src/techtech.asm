
	#import "../main.asm"
	.encoding "screencode_upper"

//---------------------------------------

.var	Screen 	= $0400
.var	Color 	= $D800

.var	rirq_count 		= $20
.var	offset		 	= $21

.var 	COLORS_COUNT 	= 256
.var 	MAP_COUNT 		= 112
.var 	CHARSET_COUNT 	= 2048
.var 	MAP_WIDTH		= 28
.var 	MAP_HEIGHT 		= 4

//---------------------------------------

.macro IRQ_ENTER() {
	pha
	tya
	pha
	txa
	pha
}

.macro IRQ_SET(irqvec, rasterline) {
	ldx #<irqvec
	ldy #>irqvec
	stx $FFFE
	sty $FFFF
	lda rasterline
	sta VIC_HLINE
	lsr VIC_CTRL1
}

.macro IRQ_SET_IMMEDIATE(irqvec, rasterline) {
	ldx #<irqvec
	ldy #>irqvec
	stx $FFFE
	sty $FFFF
	lda #rasterline
	sta VIC_HLINE
	lsr VIC_CTRL1
}

.macro XWAIT(delay) {
	ldx #delay
!:	dex
	bne !-
}

.macro YWAIT(delay) {
	ldy #delay
!:	dey
	bne !-
}

//-----------------------------------------------------

*=$0801 "Basic"
BasicUpstart2(setup)
*=$810 "Program"

setup:
	sei

	SetMultiColorMode()
	set_screen_char_base($400, $3800)
	ClearScreen($400, $20)
	ClearColorRam(COLOR_GRAY1)
	SetBorderColor(COLOR_BLACK)
    SetBackgroundColor(COLOR_BLACK)
    SetMultiColor1(COLOR_BLUE)
	SetMultiColor2(COLOR_WHITE)
	copyCharset(charset, $3800)

	.for(var i=0; i<8; i++) {
		copyMapCutoff(MAP_WIDTH, MAP_HEIGHT, map+(MAP_WIDTH-(i*2)), $400+(i*40*MAP_HEIGHT), (i*2))
		copyMap(MAP_WIDTH, MAP_HEIGHT, map, $400+(i*2)+(i*40*MAP_HEIGHT))
		copyMapCutoff(MAP_WIDTH, MAP_HEIGHT, map, $400+((i*2)+MAP_WIDTH)+(i*40*MAP_HEIGHT), (40-MAP_WIDTH-(i*2)))
	}

	lda #<irq0
	sta $FFFE
	lda #>irq0
	sta $FFFF
	lda #<__waitpoint
	sta $FFFA
	lda #>__waitpoint
	sta $FFFB

	lda #$04
	sta VIC_HLINE
	lda #$01
	sta offset
	sta rirq_count
	lda #$35
	sta $01
	cli

!:	lda #$00
!:	cmp VIC_HLINE
	bne !-
	jmp !--

irq0:
	IRQ_ENTER()
	ldx #<irq0
	ldy #>irq0
	stx $FFFE
	sty $FFFF
	inc rirq_count
	lda rirq_count
	beq !++
	and #%00111111
	tax
	lda sine256,x
!:	ora #16
	sta VIC_CTRL2
!:	pla
	tax
	pla
	tay
	pla
	lsr VIC_IRR
	inc VIC_HLINE
	inc VIC_HLINE
	rti

__waitpoint:
	rti

//---------------------------------------

sine256:
		.byte 4,3,3,2,2,2,1,1,1,0,0,0,0,0,0,0
	.byte 0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3
	.byte 4,4,4,5,5,6,6,6,6,7,7,7,7,7,7,7
	.byte 7,7,7,7,7,7,7,6,6,6,5,5,5,4,4,4

map:
	.byte $20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20
	.byte $20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$86,$a3,$c6
	.byte $86,$a3,$c6,$87,$a7,$c7,$86,$a3,$c6,$83,$84,$85,$87,$a7,$c7,$80
	.byte $81,$82,$86,$a3,$c6,$c3,$c4,$c5,$20,$a6,$20,$e6,$a6,$20,$e6,$20
	.byte $a6,$20,$a6,$e4,$e5,$a6,$a4,$a5,$20,$a6,$20,$a0,$a1,$a2,$a6		// 32
	.byte $20,$e6,$a6,$e3,$e6,$20,$c0,$20,$c0,$e0,$e1,$e2,$20,$c0,$20,$c0	// 48
	.byte $20,$c0,$c0,$20,$c0,$20,$c0,$20,$20,$c0,$20,$e0,$e1,$e2,$c0,$20	// 64
	.byte $c0																// 80

charset:
	.byte $3c,$66,$6e,$6e,$60,$62,$3c,$00,$18,$3c,$66,$7e,$66,$66,$66,$00	// 0
	.byte $7c,$66,$66,$7c,$66,$66,$7c,$00,$3c,$66,$60,$60,$60,$66,$3c,$00	// 16
	.byte $78,$6c,$66,$66,$66,$6c,$78,$00,$7e,$60,$60,$78,$60,$60,$7e,$00	// 32
	.byte $7e,$60,$60,$78,$60,$60,$60,$00,$3c,$66,$60,$6e,$66,$66,$3c,$00	// 48
	.byte $66,$66,$66,$7e,$66,$66,$66,$00,$3c,$18,$18,$18,$18,$18,$3c,$00	// 64
	.byte $1e,$0c,$0c,$0c,$0c,$6c,$38,$00,$66,$6c,$78,$70,$78,$6c,$66,$00	// 80
	.byte $60,$60,$60,$60,$60,$60,$7e,$00,$63,$77,$7f,$6b,$63,$63,$63,$00	// 96
	.byte $66,$76,$7e,$7e,$6e,$66,$66,$00,$3c,$66,$66,$66,$66,$66,$3c,$00	// 112
	.byte $7c,$66,$66,$7c,$60,$60,$60,$00,$3c,$66,$66,$66,$66,$3c,$0e,$00	// 128
	.byte $7c,$66,$66,$7c,$78,$6c,$66,$00,$3c,$66,$60,$3c,$06,$66,$3c,$00	// 144
	.byte $7e,$18,$18,$18,$18,$18,$18,$00,$66,$66,$66,$66,$66,$66,$3c,$00	// 160
	.byte $66,$66,$66,$66,$66,$3c,$18,$00,$63,$63,$63,$6b,$7f,$77,$63,$00	// 176
	.byte $66,$66,$3c,$18,$3c,$66,$66,$00,$66,$66,$66,$3c,$18,$18,$18,$00	// 192
	.byte $7e,$06,$0c,$18,$30,$60,$7e,$00,$3c,$30,$30,$30,$30,$30,$3c,$00	// 208
	.byte $0c,$12,$30,$7c,$30,$62,$fc,$00,$3c,$0c,$0c,$0c,$0c,$0c,$3c,$00	// 224
	.byte $00,$18,$3c,$7e,$18,$18,$18,$18,$00,$10,$30,$7f,$7f,$30,$10,$00	// 240
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$18,$18,$18,$18,$00,$00,$18,$00	// 256
	.byte $66,$66,$66,$00,$00,$00,$00,$00,$66,$66,$ff,$66,$ff,$66,$66,$00	// 272
	.byte $18,$3e,$60,$3c,$06,$7c,$18,$00,$62,$66,$0c,$18,$30,$66,$46,$00	// 288
	.byte $3c,$66,$3c,$38,$67,$66,$3f,$00,$06,$0c,$18,$00,$00,$00,$00,$00	// 304
	.byte $0c,$18,$30,$30,$30,$18,$0c,$00,$30,$18,$0c,$0c,$0c,$18,$30,$00	// 320
	.byte $00,$66,$3c,$ff,$3c,$66,$00,$00,$00,$18,$18,$7e,$18,$18,$00,$00	// 336
	.byte $00,$00,$00,$00,$00,$18,$18,$30,$00,$00,$00,$7e,$00,$00,$00,$00	// 352
	.byte $00,$00,$00,$00,$00,$18,$18,$00,$00,$03,$06,$0c,$18,$30,$60,$00	// 368
	.byte $3c,$66,$6e,$76,$66,$66,$3c,$00,$18,$18,$38,$18,$18,$18,$7e,$00	// 384
	.byte $3c,$66,$06,$0c,$30,$60,$7e,$00,$3c,$66,$06,$1c,$06,$66,$3c,$00	// 400
	.byte $06,$0e,$1e,$66,$7f,$06,$06,$00,$7e,$60,$7c,$06,$06,$66,$3c,$00	// 416
	.byte $3c,$66,$60,$7c,$66,$66,$3c,$00,$7e,$66,$0c,$18,$18,$18,$18,$00	// 432
	.byte $3c,$66,$66,$3c,$66,$66,$3c,$00,$3c,$66,$66,$3e,$06,$66,$3c,$00	// 448
	.byte $00,$00,$18,$00,$00,$18,$00,$00,$00,$00,$18,$00,$00,$18,$18,$30	// 464
	.byte $0e,$18,$30,$60,$30,$18,$0e,$00,$00,$00,$7e,$00,$7e,$00,$00,$00	// 480
	.byte $70,$18,$0c,$06,$0c,$18,$70,$00,$3c,$66,$06,$0c,$18,$00,$18,$00	// 496
	.byte $00,$00,$00,$ff,$ff,$00,$00,$00,$08,$1c,$3e,$7f,$7f,$1c,$3e,$00	// 512
	.byte $18,$18,$18,$18,$18,$18,$18,$18,$00,$00,$00,$ff,$ff,$00,$00,$00	// 528
	.byte $00,$00,$ff,$ff,$00,$00,$00,$00,$00,$ff,$ff,$00,$00,$00,$00,$00	// 544
	.byte $00,$00,$00,$00,$ff,$ff,$00,$00,$30,$30,$30,$30,$30,$30,$30,$30	// 560
	.byte $0c,$0c,$0c,$0c,$0c,$0c,$0c,$0c,$00,$00,$00,$e0,$f0,$38,$18,$18	// 576
	.byte $18,$18,$1c,$0f,$07,$00,$00,$00,$18,$18,$38,$f0,$e0,$00,$00,$00	// 592
	.byte $c0,$c0,$c0,$c0,$c0,$c0,$ff,$ff,$c0,$e0,$70,$38,$1c,$0e,$07,$03	// 608
	.byte $03,$07,$0e,$1c,$38,$70,$e0,$c0,$ff,$ff,$c0,$c0,$c0,$c0,$c0,$c0	// 624
	.byte $ff,$ff,$03,$03,$03,$03,$03,$03,$00,$3c,$7e,$7e,$7e,$7e,$3c,$00	// 640
	.byte $00,$00,$00,$00,$00,$ff,$ff,$00,$36,$7f,$7f,$7f,$3e,$1c,$08,$00	// 656
	.byte $60,$60,$60,$60,$60,$60,$60,$60,$00,$00,$00,$07,$0f,$1c,$18,$18	// 672
	.byte $c3,$e7,$7e,$3c,$3c,$7e,$e7,$c3,$00,$3c,$7e,$66,$66,$7e,$3c,$00	// 688
	.byte $18,$18,$66,$66,$18,$18,$3c,$00,$06,$06,$06,$06,$06,$06,$06,$06	// 704
	.byte $08,$1c,$3e,$7f,$3e,$1c,$08,$00,$18,$18,$18,$ff,$ff,$18,$18,$18	// 720
	.byte $c0,$c0,$30,$30,$c0,$c0,$30,$30,$18,$18,$18,$18,$18,$18,$18,$18	// 736
	.byte $00,$00,$03,$3e,$76,$36,$36,$00,$ff,$7f,$3f,$1f,$0f,$07,$03,$01	// 752
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$f0,$f0,$f0,$f0,$f0,$f0,$f0,$f0	// 768
	.byte $00,$00,$00,$00,$ff,$ff,$ff,$ff,$ff,$00,$00,$00,$00,$00,$00,$00	// 784
	.byte $00,$00,$00,$00,$00,$00,$00,$ff,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0	// 800
	.byte $cc,$cc,$33,$33,$cc,$cc,$33,$33,$03,$03,$03,$03,$03,$03,$03,$03	// 816
	.byte $00,$00,$00,$00,$cc,$cc,$33,$33,$ff,$fe,$fc,$f8,$f0,$e0,$c0,$80	// 832
	.byte $03,$03,$03,$03,$03,$03,$03,$03,$18,$18,$18,$1f,$1f,$18,$18,$18	// 848
	.byte $00,$00,$00,$00,$0f,$0f,$0f,$0f,$18,$18,$18,$1f,$1f,$00,$00,$00	// 864
	.byte $00,$00,$00,$f8,$f8,$18,$18,$18,$00,$00,$00,$00,$00,$00,$ff,$ff	// 880
	.byte $00,$00,$00,$1f,$1f,$18,$18,$18,$18,$18,$18,$ff,$ff,$00,$00,$00	// 896
	.byte $00,$00,$00,$ff,$ff,$18,$18,$18,$18,$18,$18,$f8,$f8,$18,$18,$18	// 912
	.byte $c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0,$e0,$e0,$e0,$e0,$e0,$e0,$e0,$e0	// 928
	.byte $07,$07,$07,$07,$07,$07,$07,$07,$ff,$ff,$00,$00,$00,$00,$00,$00	// 944
	.byte $ff,$ff,$ff,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$ff,$ff,$ff	// 960
	.byte $03,$03,$03,$03,$03,$03,$ff,$ff,$00,$00,$00,$00,$f0,$f0,$f0,$f0	// 976
	.byte $0f,$0f,$0f,$0f,$00,$00,$00,$00,$18,$18,$18,$f8,$f8,$00,$00,$00	// 992
	.byte $f0,$f0,$f0,$f0,$00,$00,$00,$00,$f0,$f0,$f0,$f0,$0f,$0f,$0f,$0f	// 1008
	.byte $08,$3b,$2a,$2a,$2a,$3a,$1b,$0e,$00,$00,$00,$00,$40,$c0,$80,$c0	// 1024
	.byte $08,$3b,$2a,$2a,$6a,$eb,$b9,$ec,$0e,$3a,$2a,$2a,$3a,$2a,$3a,$2e	// 1040
	.byte $ab,$aa,$aa,$c1,$00,$00,$00,$00,$40,$b0,$ac,$a9,$6b,$2a,$2b,$69	// 1056
	.byte $00,$03,$0e,$0a,$3a,$2a,$3a,$2e,$01,$3a,$2a,$3a,$01,$00,$00,$00	// 1072
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1088
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1104
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1120
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1136
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1152
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1168
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1184
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1200
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1216
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1232
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1248
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1264
	.byte $0f,$07,$03,$01,$00,$00,$00,$00,$91,$e2,$b7,$fe,$7f,$df,$77,$1d	// 1280
	.byte $bc,$e4,$b0,$d0,$c0,$c0,$40,$00,$7b,$aa,$aa,$aa,$b3,$c0,$00,$00	// 1296
	.byte $01,$46,$ee,$fb,$df,$41,$00,$00,$a8,$a4,$d0,$40,$d0,$f4,$fc,$7d	// 1312
	.byte $3b,$3e,$3b,$3e,$3f,$1f,$3f,$1f,$7f,$aa,$aa,$aa,$ea,$2e,$3a,$2e	// 1328
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1344
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1360
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1376
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1392
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1408
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1424
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1440
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1456
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1472
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1488
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1504
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1520
	.byte $37,$1d,$17,$05,$17,$05,$11,$04,$1d,$37,$15,$07,$15,$05,$11,$04	// 1536
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$03,$0e,$3a,$2a,$3a,$2a,$3a,$2e	// 1552
	.byte $00,$c0,$80,$b3,$ae,$aa,$ea,$3b,$30,$ec,$ab,$aa,$aa,$aa,$ee,$3a	// 1568
	.byte $40,$b0,$ac,$a8,$ab,$ea,$2e,$3a,$50,$ab,$aa,$ab,$d0,$00,$00,$00	// 1584
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1600
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1616
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1632
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1648
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1664
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1680
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1696
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1712
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1728
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1744
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1760
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1776
	.byte $37,$1d,$17,$15,$05,$04,$01,$00,$00,$00,$40,$c0,$77,$55,$11,$44	// 1792
	.byte $37,$1d,$57,$d5,$54,$44,$10,$40,$0c,$04,$00,$00,$00,$00,$00,$00	// 1808
	.byte $00,$00,$00,$c0,$bb,$ef,$ff,$40,$2e,$3b,$2e,$bb,$fe,$ff,$fe,$7f	// 1824
	.byte $2e,$3b,$3e,$3b,$3e,$1f,$3e,$1f,$00,$00,$00,$00,$00,$00,$00,$00	// 1840
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1856
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1872
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1888
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1904
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1920
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1936
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1952
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1968
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 1984
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 2000
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 2016
	.byte $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	// 2032
